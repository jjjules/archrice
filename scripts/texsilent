#!/bin/sh -e
# Silent compiler for latex file.
# Provided the name of the latex file (in *.tex format),
# it will compile it and remove all auxiliary files.
# Take an optional second parameter specifying the latex engine.

cleanup () {
	nfiles_before=$1
	nfiles_after=$(eval "ls -p | grep -Ev '/$|*\.pdf' | wc -l")
	ncreatedfiles=$(($nfiles_after-$nfiles))

	ls -trp | grep -Ev '/$|*\.pdf' | tail -n $ncreatedfiles | xargs rm --
}
nfiles=$(eval "ls -p | grep -Ev '/$|*\.pdf' | wc -l")
trap "cleanup '$nfiles'" EXIT

if [ $# -eq 1 ]
then
	engine='xelatex'
elif [ $# -eq 2 ]
then
	engine=$2
else
	echo 'The maximum number of arguments is 2 (file and engine)'
fi

$engine "$1"
