#!/usr/bin/bash
#case $BLOCK_BUTTON in
#	1) kill $(ps aux | grep $HOME/.config/i3blocks/bin/battery | grep -v 'grep' | tr -s " " | cut -d' ' -f2) ;;
#esac

# low battery in %
low_threshold=15
crit_threshold=10

# Getting the actual percentage of each battery
capacity0=$(cat /sys/class/power_supply/BAT0/capacity)
capacity1=$(cat /sys/class/power_supply/BAT1/capacity)
capacity=$(echo "$capacity0*0.5+$capacity1*0.2" | bc)
capacity=${capacity%.*}

# Getting the statuses
status0=$(cat /sys/class/power_supply/BAT0/status)
status1=$(cat /sys/class/power_supply/BAT1/status)

battery_emoji="üîã"
status_charging="‚ö°"
status_low="‚ö†Ô∏è"

crit_icon='/usr/share/icons/Adwaita/16x16/status/dialog-warning-symbolic.symbolic.png'

# Test status
if [ "$status0" = "Charging" ] || [ "$status1" = "Charging" ]
then
	printf "%s%s%s\n" "$capacity%" "$battery_emoji" "$status_charging"
elif [ "$capacity" -gt "$low_threshold" ]
then
	printf "%s%s\n" "$capacity%" "$battery_emoji"
elif [ "$capacity" -le "$crit_threshold" ]
then
	if [[ $capacity -lt 4 ]]
	then
		dunstify -u critical -r 30004 -i $crit_icon "Critical battery"
	fi
	printf "%s%s%s\n\n#ff0000\n" "$capacity%" "$battery_emoji" "$status_low"
else
	printf "%s%s\n\n#ff0000\n" "$capacity%" "$battery_emoji"
fi
